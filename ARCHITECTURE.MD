# ğŸ—ï¸ CarFlow API Architecture

## ğŸ“‹ System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚     â”‚                 â”‚     â”‚                         â”‚
â”‚    Client       â”‚â”€â”€â”€â”€â–¶â”‚    Cloud Run    â”‚â”€â”€â”€â”€â–¶â”‚    In-Memory Storage    â”‚
â”‚  Applications   â”‚â—€â”€â”€â”€â”€â”‚    API Server   â”‚â—€â”€â”€â”€â”€â”‚     (Future: PostgreSQL)â”‚
â”‚                 â”‚     â”‚                 â”‚     â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚     â–²
                              â”‚     â”‚
                              â–¼     â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                 â”‚
                        â”‚   Middleware    â”‚
                        â”‚      Chain      â”‚
                        â”‚                 â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© Architecture Design Principles

### ğŸ“Š Clean Architecture

The CarFlow API follows the principles of Clean Architecture, separating concerns into distinct layers:

1. **Domain Layer** - Core business entities and logic
2. **Service Layer** - Application-specific business rules
3. **Handler Layer** - HTTP request/response handling
4. **Infrastructure Layer** - External systems integration

This separation ensures:
- âœ… Business logic is independent of frameworks and external systems
- âœ… Easy testability at all levels
- âœ… Flexibility to change infrastructure without affecting business logic

## ğŸ”„ Request Flow

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚          â”‚      â”‚            â”‚      â”‚            â”‚      â”‚             â”‚      â”‚            â”‚
  â”‚  Client  â”‚â”€â”€â”€â”€â”€â–¶â”‚ Middleware â”‚â”€â”€â”€â”€â”€â–¶â”‚  Handler   â”‚â”€â”€â”€â”€â”€â–¶â”‚  Service    â”‚â”€â”€â”€â”€â”€â–¶â”‚ Repository â”‚
  â”‚ Request  â”‚      â”‚   Chain    â”‚      â”‚  Layer     â”‚      â”‚  Layer      â”‚      â”‚ Layer      â”‚
  â”‚          â”‚      â”‚            â”‚      â”‚            â”‚      â”‚             â”‚      â”‚            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                       â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚          â”‚      â”‚            â”‚      â”‚            â”‚      â”‚             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  Client  â”‚â—€â”€â”€â”€â”€â”€â”‚ Response   â”‚â—€â”€â”€â”€â”€â”€â”‚  Handler   â”‚â—€â”€â”€â”€â”€â”€â”‚  Service    â”‚
  â”‚ Response â”‚      â”‚ Processing â”‚      â”‚  Layer     â”‚      â”‚  Layer      â”‚
  â”‚          â”‚      â”‚            â”‚      â”‚            â”‚      â”‚             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ Component Architecture

### ğŸš— Car Domain Model

```go
type Car struct {
    ID    string
    Make  string
    Model string
    Year  int
    Color string
}
```

Design decisions:
- âœ… Simple, focused entity with clear purpose
- âœ… String ID for flexibility in ID generation strategies
- âœ… Core data model with essential car properties

### ğŸ—„ï¸ Repository Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚     â”‚                         â”‚
â”‚   Repository        â”‚     â”‚   In-Memory Storage     â”‚
â”‚   Interface         â”‚â—€â”€â”€â”€â–¶â”‚   Implementation        â”‚
â”‚                     â”‚     â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
         â”‚
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
â”‚   Future Database   â”‚
â”‚   Implementation    â”‚
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… Repository pattern for data access abstraction
- âœ… Interface-based design for easy swapping of storage implementations
- âœ… In-memory implementation for initial development and testing
- âœ… Future-proof for database implementation

### ğŸ› ï¸ Service Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚     â”‚                         â”‚
â”‚   Service Layer     â”‚â”€â”€â”€â”€â–¶â”‚   Repository Layer      â”‚
â”‚                     â”‚â—€â”€â”€â”€â”€â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
â”‚   Business Logic    â”‚
â”‚   & Validation      â”‚
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… Service layer encapsulates business logic
- âœ… Input validation at the service level ensures data integrity
- âœ… Service layer orchestrates repository operations
- âœ… Clear separation of concerns from HTTP handling

### ğŸŒ HTTP Handler Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚     â”‚                         â”‚
â”‚   HTTP Handlers     â”‚â”€â”€â”€â”€â–¶â”‚   Service Layer         â”‚
â”‚                     â”‚â—€â”€â”€â”€â”€â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
â”‚   Request/Response  â”‚
â”‚   Processing        â”‚
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… RESTful API design principles
- âœ… Clear handler responsibilities: parse request, validate, call service, format response
- âœ… Error handling standardized across handlers
- âœ… JSON response formatting with consistent structure

### ğŸ”„ Middleware Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚     â”‚            â”‚     â”‚            â”‚     â”‚            â”‚     â”‚            â”‚
â”‚  Logging   â”‚â”€â”€â”€â”€â–¶â”‚  Recovery  â”‚â”€â”€â”€â”€â–¶â”‚   CORS     â”‚â”€â”€â”€â”€â–¶â”‚    Rate    â”‚â”€â”€â”€â”€â–¶â”‚   ETag     â”‚
â”‚ Middleware â”‚     â”‚ Middleware â”‚     â”‚ Middleware â”‚     â”‚  Limiting  â”‚     â”‚ Middleware â”‚
â”‚            â”‚     â”‚            â”‚     â”‚            â”‚     â”‚            â”‚     â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
                   â”‚            â”‚                                                  â”‚
                   â”‚  Metrics   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ Middleware â”‚
                   â”‚            â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚            â”‚
                   â”‚   Route    â”‚
                   â”‚  Handlers  â”‚
                   â”‚            â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… Middleware chain for cross-cutting concerns
- âœ… Composable design for flexibility
- âœ… Each middleware has a single responsibility
- âœ… Standard HTTP middleware pattern (take next handler, return handler)

## ğŸ“Š API Design

### RESTful Resource Modeling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                             â”‚
â”‚  /cars                                      â”‚
â”‚  GET    - List all cars (filtering/sorting) â”‚
â”‚  POST   - Create a new car                  â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚     â”‚                 â”‚
â”‚  /cars/{id}     â”‚     â”‚  /metrics       â”‚
â”‚  GET    - Read  â”‚     â”‚  GET - API      â”‚
â”‚  PUT    - Updateâ”‚     â”‚       metrics   â”‚
â”‚  DELETE - Deleteâ”‚     â”‚                 â”‚
â”‚                 â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… RESTful API design with standard HTTP methods
- âœ… Resource-based URL structure
- âœ… Query parameters for filtering and sorting
- âœ… Clear separation of resources

### ğŸ“‹ Query Parameter Design

| Endpoint | Parameter | Description | Example |
|----------|-----------|-------------|---------|
| GET /cars | make | Filter by manufacturer | `?make=Toyota` |
| GET /cars | model | Filter by model | `?model=Corolla` |
| GET /cars | year | Filter by year | `?year=2020` |
| GET /cars | color | Filter by color | `?color=blue` |
| GET /cars | sort | Sort field (prefix with - for desc) | `?sort=-year` |
| GET /cars | page | Page number | `?page=2` |
| GET /cars | page_size | Items per page | `?page_size=10` |

## â˜ï¸ Deployment Architecture

### Google Cloud Run Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â”‚  GitHub Actions    â”‚â”€â”€â”€â”€â–¶â”‚   Cloud Build      â”‚â”€â”€â”€â”€â–¶â”‚   Container        â”‚
â”‚     Workflow       â”‚     â”‚                    â”‚     â”‚   Registry         â”‚
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â”‚
                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚                            â”‚                    â”‚
â”‚    Cloud IAM       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    Cloud Run       â”‚
â”‚                    â”‚                            â”‚    Service         â”‚
â”‚                    â”‚                            â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                                   â–²
        â”‚                                                   â”‚
        â–¼                                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚                            â”‚                    â”‚
â”‚   Terraform IaC    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Auto-scaling     â”‚
â”‚   Configuration    â”‚                            â”‚   Configuration    â”‚
â”‚                    â”‚                            â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… Containerized deployment with Docker
- âœ… Cloud Run for serverless container execution
- âœ… Infrastructure as Code with Terraform
- âœ… CI/CD automation with GitHub Actions
- âœ… Auto-scaling configuration (0-1 instances)
- âœ… Cost optimization for free tier

## ğŸ“ˆ Observability Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                    â”‚
â”‚   Application      â”‚â”€â”€â”€â”€â–¶â”‚   Metrics          â”‚
â”‚      Logs          â”‚     â”‚   Endpoint         â”‚
â”‚                    â”‚     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚
        â”‚                           â”‚
        â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                    â”‚
â”‚   Cloud Logging    â”‚     â”‚   Health Check     â”‚
â”‚                    â”‚     â”‚   Endpoint         â”‚
â”‚                    â”‚     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… Built-in metrics collection
- âœ… Health check endpoint for monitoring
- âœ… Structured logging
- âœ… Request timing measurements
- âœ… Error tracking and reporting

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â”‚   Rate Limiting    â”‚â”€â”€â”€â”€â–¶â”‚   CORS Policy      â”‚â”€â”€â”€â”€â–¶â”‚   Recovery         â”‚
â”‚   Middleware       â”‚     â”‚                    â”‚     â”‚   Middleware       â”‚
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚
                                                              â”‚
                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚                            â”‚                    â”‚
â”‚   Input            â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Service Account  â”‚
â”‚   Validation       â”‚                            â”‚   Authentication   â”‚
â”‚                    â”‚                            â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions:
- âœ… Rate limiting to prevent abuse
- âœ… CORS configuration for browser security
- âœ… Panic recovery to prevent service disruption
- âœ… Input validation for all operations
- âœ… Service account-based authentication for GCP resources

## ğŸ”„ Future Architecture Enhancements

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â”‚   PostgreSQL       â”‚â”€â”€â”€â”€â–¶â”‚   Redis Cache      â”‚â”€â”€â”€â”€â–¶â”‚   Authentication   â”‚
â”‚   Database         â”‚     â”‚                    â”‚     â”‚   Service          â”‚
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚                          â”‚
        â”‚                           â”‚                          â”‚
        â–¼                           â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â”‚   Event-Driven     â”‚     â”‚   Advanced         â”‚     â”‚   Stripe Payment   â”‚
â”‚   Architecture     â”‚     â”‚   Monitoring       â”‚     â”‚   Integration      â”‚
â”‚                    â”‚     â”‚                    â”‚     â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Design decisions for future enhancements:
- âœ… Database persistence with PostgreSQL
- âœ… Caching layer with Redis
- âœ… JWT-based authentication and authorization
- âœ… Event-driven architecture for scalability
- âœ… Advanced monitoring and observability
- âœ… Integration with third-party services (Stripe, Brevo, Twilio)

## ğŸ§  Key Architectural Decisions

1. **Lightweight Initial Design**
   - Started with a minimal, in-memory implementation for rapid development
   - Designed with future database integration in mind

2. **Clean Separation of Concerns**
   - Core domain model independent of infrastructure
   - Repository pattern for data access abstraction
   - Service layer for business logic
   - Handler layer for HTTP concerns

3. **RESTful API Design**
   - Resource-based routing
   - Standard HTTP methods
   - Query parameters for filtering, sorting, and pagination
   - Consistent response formats

4. **Cloud-Native Deployment**
   - Containerized with Docker
   - Deployed to serverless Cloud Run
   - Infrastructure as Code with Terraform
   - CI/CD with GitHub Actions

5. **Observability First**
   - Built-in metrics collection
   - Health check endpoint
   - Structured logging

6. **Security Focus**
   - Rate limiting
   - Input validation
   - CORS configuration
   - Recovery middleware
   - Service account authentication

7. **Future Scaling Considerations**
   - Database persistence
   - Caching
   - Authentication
   - Monitoring
   - Third-party integrations

These architectural decisions ensure the CarFlow API is:
- âœ… Maintainable
- âœ… Testable
- âœ… Scalable
- âœ… Secure
- âœ… Observable
- âœ… Cloud-native
- âœ… Cost-effective 